<div class="w-full">
  <div class="flex justify-center items-center mt-10">
    <div class="max-w-md min-w-md">
      <p-inputgroup>
        <input pInputText placeholder="Search your note"/>
        <p-inputgroup-addon>
          <p-button icon="pi pi-search" severity="secondary" variant="text"/>
        </p-inputgroup-addon>
      </p-inputgroup>
    </div>
    <div class="max-w-md">
      <p-button icon="pi pi-file-edit" severity="success" variant="text" label="Create note"
                (click)="showDialogCreateNote()"/>
    </div>
  </div>
</div>
<div class="w-full mt-10 p-10">
  <div class="card">
    <div class="mb-4">
      <p-button type="button" icon="pi pi-chevron-left" (click)="prev()" [disabled]="isFirstPage()" text/>
      <p-button type="button" icon="pi pi-refresh" (click)="reset()" text/>
      <p-button type="button" icon="pi pi-chevron-right" (click)="next()" [disabled]="isLastPage()" text/>
    </div>

    <p-table [columns]="colsTable" [value]="notes" [paginator]="true"
             [rows]="10"
             [first]="first"
             [totalRecords]="totalRecords"
             [showCurrentPageReport]="true"
             [tableStyle]="{ 'min-width': '50rem' }"
             currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
             (onPage)="pageChange($event)"
             [rowsPerPageOptions]="[10, 25, 50]">
      <ng-template #header let-columns>
        <tr>
          <th *ngFor="let col of columns">
            {{ col.header }}
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-note let-columns="columns">
        <tr>
          <td>
            {{ note['id'] }}
          </td>
          <td>
            {{ note['createdAt'] | date:'dd/MM/yyyy HH:mm:ss':'UTC+7'}}
          </td>
          <td>
            {{ note['title'] }}
          </td>
          <td>
            <p-button icon="pi pi-eye" severity="help" class="mr-2" [rounded]="true" [outlined]="true" pTooltip="View content" (click)="viewNoteContent(note['id'])"/>
          </td>
          <td>
            <p-button icon="pi pi-share-alt" class="mr-2" severity="info" [rounded]="true" [outlined]="true" pTooltip="Share your note" (click)="showQr(note['id'])"/>
            <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true"  pTooltip="Edit"/>
            <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true"  pTooltip="Delete"/>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
<p-dialog maskStyleClass="backdrop-blur-sm" header="Create Note" [(visible)]="visibleEditor"
          [style]="{ width: '75rem' }"
          styleClass="!border-0 !bg-transparent" [maximizable]="true" [draggable]="false">
  <form [formGroup]="noteForm" (ngSubmit)="submitNote($event)">
    <div class="flex items-center gap-4 mb-4">
      <label for="title" class="font-semibold w-24">Title</label>
      <input pInputText id="title" class="flex-auto" autocomplete="off" formControlName="title"/>
    </div>
    <div class="flex items-center gap-4 mb-8">
      <span class="font-bold">Content</span>
      <br>
      <p-editor class="w-full" formControlName="content" [style]="{ height: '320px' }"/>
    </div>
    <div class="flex justify-end gap-2">
      <p-button label="Cancel" severity="secondary" (click)="visibleEditor = false"/>
      <p-button label="Save" type="submit"/>
    </div>
  </form>
</p-dialog>
<p-dialog maskStyleClass="backdrop-blur-sm" header="View Note" [(visible)]="visibleViewer"
          [style]="{ width: '75rem' }"
          styleClass="!border-0 !bg-transparent" [maximizable]="true" [draggable]="false">
  <p-fieldset legend="Title" [toggleable]="false">
    <p>
      {{currentNote?.title}}
    </p>
  </p-fieldset>
  <p-fieldset legend="Created at" [toggleable]="false">
    <p>
      {{currentNote?.createdAt | date:'dd/MM/yyyy HH:mm:ss':'UTC'}}
    </p>
  </p-fieldset>
  <p-fieldset legend="Content" [toggleable]="false">
    <div [innerHTML]="safeContent"></div>
  </p-fieldset>
</p-dialog>

<p-dialog header="QR share" [modal]="true" [(visible)]="visibleQr" [style]="{ width: '25rem' }">
  <div class="flex justify-center gap-2">
    <p-image [src]="qrNote" alt="Image" width="250" />
  </div>
  <div class="flex justify-center justify-items-center gap-2">
    <span>{{qrLink()}}</span>
  </div>
  <div class="flex justify-center justify-items-center gap-2 mt-4">
    <button pButton>
      <i class="pi pi-copy" pButtonIcon></i>
      <span pButtonLabel>Copy link</span>
    </button>
  </div>

</p-dialog>
<p-toast/>
